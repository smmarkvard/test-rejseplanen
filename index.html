<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Afgange – AAU Fibigerstræde</title>
  <style>
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#ffffff; color:#000000; }
    header { padding: 14px 16px; border-bottom: 1px solid rgb(255, 255, 255); display:flex; gap:12px; align-items:baseline; }
    header .title { font-weight: 700; }
    header .meta { opacity: .7; font-size: 13px; }

    /* "Fake crop" container */
    .crop {
    width: 1000px;
    height: 400px;          /* ↓ lavere = cropper bunden væk */
    overflow: hidden;

    margin: 18px 0 0 18px;  /* ← venstre-placeret (ikke centreret) */
    /* eller helt til venstre: margin: 18px 0 0 0; */

    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(255, 255, 255, 0.35);
    border: 1px solid rgb(255, 255, 255);
    background: #ffffff;
    position: relative;
    }

    iframe {
    width: 1400px;
    height: 1000px;
    border: 0;
    position: relative;

    top: -220px;   /* ↑ mere negativ = cropper toppen (header/knapper væk) */
    left: 0px;     /* ← helt til venstre */
    }

    /* Loading overlay */
    .overlay {
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.98), rgba(179, 179, 179, 0.98));
      color:#e8eefc;
      font-size: 16px;
      letter-spacing: .2px;
    }
    .overlay small { display:block; margin-top:8px; opacity:.7; font-size: 13px; text-align:center; }

    .hidden { display: none; }

    /* Mobile-ish fallback */
    @media (max-width: 820px) {
      .crop { width: 96vw; height: 70vh; }
      iframe { width: 1400px; height: 1000px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="title">Afgange – AAU Fibigerstræde (Bertil Ohlins Vej)</div>
  </header>

  <div class="crop">
    <div class="overlay" id="overlay">
      Indlæser afgangstavle…
      <small>Hvis den ikke dukker op, prøver siden automatisk igen.</small>
    </div>

    <iframe
      id="rp"
      loading="eager"
      referrerpolicy="no-referrer"
      title="Rejseplanen afgangstavle">
    </iframe>
  </div>

  <script>
    // --- Konfiguration ---
    const STOP_ID = "851991502";       // AAU Fibigerstræde (Bertil Ohlins Vej)
    const MAX_JOURNEYS = 12;
    const AUTO_REFRESH_MIN = 2;        // refresh hvert 2. minut (til skærm på kontor)

    // Tip: 'time=now' og 'selectDate=today' gør den robust uden brugerinput.
    function buildUrl() {
      const params = new URLSearchParams({
        L: "vs_rp4",
        boardType: "dep",
        input: STOP_ID,
        selectDate: "today",
        time: "now",
        start: "yes",
        maxJourneys: String(MAX_JOURNEYS)
      });
      return `https://www.rejseplanen.dk/bin/stboard.exe/mn?${params.toString()}`;
    }

    const iframe  = document.getElementById("rp");
    const overlay = document.getElementById("overlay");
    const status  = document.getElementById("status");

    let loadedOnce = false;
    let didRetry = false;

    function loadFresh(){
        const u = new URL(base);
        u.searchParams.set("_", Date.now()); // cache-buster
        iframe.src = u.toString();
    }

    function setStatus(msg) {
      const now = new Date();
      const hh = String(now.getHours()).padStart(2, "0");
      const mm = String(now.getMinutes()).padStart(2, "0");
      status.textContent = `${msg} • ${hh}:${mm}`;
    }

    function loadBoard() {
      overlay.classList.remove("hidden");
      iframe.src = buildUrl();
    }

    // Auto-refresh (godt til kiosk/skærm)
    setInterval(() => {
      setStatus("opdaterer");
      const u = new URL(buildUrl());
      u.searchParams.set("_", Date.now().toString());
      iframe.src = u.toString();
    }, AUTO_REFRESH_MIN * 60 * 1000);

    // Start
    loadBoard();
    loadFresh();
  </script>
</body>
</html>
